<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pháo hoa</title>
  <style>
    html, body { margin:0; height:100%; overflow:hidden; background:#000; }
    .canvas-container { position:fixed; inset:0; }
    #trails-canvas, #main-canvas { position:absolute; inset:0; width:100%; height:100%; display:block; }
    .hint { position:fixed; left:12px; top:12px; color:#fff; font-family:system-ui; z-index:10; opacity:.85; }
  </style>
</head>
<body>

  <div class="canvas-container">
    <canvas id="trails-canvas"></canvas>
    <canvas id="main-canvas"></canvas>
  </div>

  <script>
    // Luôn chạy sau khi DOM đã có canvas
    const main = document.getElementById('main-canvas');
    const ctx = main.getContext('2d');

    function resize() {
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      main.width  = Math.floor(innerWidth * dpr);
      main.height = Math.floor(innerHeight * dpr);
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }
    addEventListener('resize', resize);
    resize();

    const parts = [];
    const g = 0.08;
    const rand = (a,b)=>a+Math.random()*(b-a);

    function boom(x,y){
      const n = Math.floor(rand(70, 140));
      const hue = rand(0, 360);
      for (let i=0;i<n;i++){
        const a = Math.random()*Math.PI*2;
        const sp = rand(2, 6);
        parts.push({
          x, y,
          vx: Math.cos(a)*sp,
          vy: Math.sin(a)*sp,
          life: rand(60, 120),
          hue
        });
      }
    }

    // click để bắn
    addEventListener('click', e => boom(e.clientX, e.clientY));

    // auto bắn để test
    setInterval(() => boom(rand(80, innerWidth-80), rand(80, innerHeight*0.6)), 700);

    function loop(){
      // nền mờ tạo vệt
      ctx.fillStyle = 'rgba(0,0,0,0.22)';
      ctx.fillRect(0,0, innerWidth, innerHeight);

      for (let i=parts.length-1;i>=0;i--){
        const p = parts[i];
        p.vy += g;
        p.x += p.vx;
        p.y += p.vy;
        p.life--;

        const a = Math.max(0, Math.min(1, p.life/120));
        ctx.fillStyle = `hsla(${p.hue},100%,60%,${a})`;
        ctx.beginPath();
        ctx.arc(p.x, p.y, 2, 0, Math.PI*2);
        ctx.fill();

        if (p.life <= 0) parts.splice(i,1);
      }
      requestAnimationFrame(loop);
    }
    loop();
  </script>
</body>
</html>

